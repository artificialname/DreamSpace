<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Soundwave Dream Analysis</title>
    <meta name="description" content="Sublime dream analysis and dream interpretation." />
    <meta name="keywords" content="dream analysis, dream interpretation, soundwave, sleep, dream insights" />
    <meta name="robots" content="index, follow" />
    <style>
        /* Styling remains unchanged for brevity */
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            Harmonize your dreams with sound waves, receive a sublime interpretation.
        </div>
    </div>
    <div class="container">
        <div class="instructions">
            <h1>Soundwave Dream Analysis</h1>
            <p>For optimal results:</p>
            <ol>
                <li>Play the sound wave track while you sleep. <a href="https://www.youtube.com/" target="_blank" rel="noopener noreferrer">Find the track here</a>.</li>
                <li>Describe your dream below in as much detail as possible.</li>
            </ol>
        </div>
        <div class="dropdown-container">
            <select id="country" aria-label="Select Country">
                <option value="">Select Country</option>
            </select>
            <select id="age" aria-label="Select Age">
                <option value="">Select Age</option>
                <option value="Under 18">Under 18</option>
                <option value="18-25">18-25</option>
                <option value="26-35">26-35</option>
                <option value="36-50">36-50</option>
                <option value="51+">51+</option>
            </select>
            <select id="soundWave" aria-label="Sound Wave Baseline">
                <option value="">Did you use the sound wave baseline?</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
        </div>
        <h1>Describe your dream here:</h1>
        <textarea id="question" placeholder="Type your dream description here..." rows="5"></textarea>
        <button id="analyzeButton" onclick="askChatGPT()" aria-label="Analyze Dream">Click here for dream analysis</button>
        <div id="response" aria-live="polite"></div>
    </div>
    <script>
        const analyzeButton = document.getElementById('analyzeButton');
        const countryDropdown = document.getElementById('country');
        const ageDropdown = document.getElementById('age');
        const soundWaveDropdown = document.getElementById('soundWave');
        const questionTextArea = document.getElementById('question');
        const responseDiv = document.getElementById('response');

        const countries = [
            "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", /* More countries */ "Zimbabwe"
        ];

        // Populate country dropdown
        countries.forEach(country => {
            const option = document.createElement("option");
            option.value = country;
            option.textContent = country;
            countryDropdown.appendChild(option);
        });

        function validateForm() {
            let isValid = true;

            [countryDropdown, ageDropdown, soundWaveDropdown].forEach(select => {
                if (!select.value) {
                    select.classList.add('error');
                    isValid = false;
                } else {
                    select.classList.remove('error');
                }
            });

            if (!questionTextArea.value.trim()) {
                questionTextArea.classList.add('error');
                isValid = false;
            } else {
                questionTextArea.classList.remove('error');
            }

            analyzeButton.classList.toggle('active', isValid);
        }

        countryDropdown.addEventListener('change', validateForm);
        ageDropdown.addEventListener('change', validateForm);
        soundWaveDropdown.addEventListener('change', validateForm);
        questionTextArea.addEventListener('input', validateForm);

        async function askChatGPT() {
            if (!analyzeButton.classList.contains('active')) {
                responseDiv.textContent = 'Please complete the form properly before submitting.';
                return;
            }

            const question = questionTextArea.value.trim();

            if (!question) {
                responseDiv.textContent = 'Dream description is required.';
                return;
            }

            analyzeButton.disabled = true;
            responseDiv.textContent = 'Analyzing your dream...';

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        country: countryDropdown.value,
                        age: ageDropdown.value,
                        soundWave: soundWaveDropdown.value,
                        question
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    responseDiv.textContent = result.analysis || 'Unable to analyze the dream.';
                } else {
                    throw new Error('Network response was not ok');
                }
            } catch (error) {
                responseDiv.textContent = 'An error occurred: ' + error.message;
            } finally {
                analyzeButton.disabled = false;
            }
        }
    </script>
</body>
</html>
