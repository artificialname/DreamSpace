<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soundwave Dream Analysis</title>
    <style>
        /* Existing styles omitted for brevity */
        #warningBox {
            display: none; /* Hidden by default */
            margin-top: 10px;
            padding: 10px;
            border: 1px solid red;
            border-radius: 5px;
            background-color: rgba(255, 0, 0, 0.1);
            color: red;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            Harmonize your dreams with sound waves, receive a sublime interpretation.
        </div>
    </div>
    <div class="container">
        <div class="instructions">
            <h1>Soundwave Dream Analysis</h1>
            <p>For optimal results:</p>
            <ol>
                <li>Play <a href="https://www.youtube.com/" target="_blank">this</a> sound wave track while you sleep. Be sure to use your phoneâ€™s second-lowest volume setting, the sound need not be audible while awake.</li>
                <li>Once you have slept, describe your dream below in as much detail as possible.</li>
            </ol>
        </div>
        <div class="dropdown-container">
            <select id="country" aria-label="Select Country">
                <option value="">Select Country</option>
                <!-- All countries will be loaded here -->
            </select>
            <select id="age" aria-label="Select Age">
                <option value="">Select Age</option>
                <option value="Under 18">Under 18</option>
                <option value="18-25">18-25</option>
                <option value="26-35">26-35</option>
                <option value="36-50">36-50</option>
                <option value="51+">51+</option>
            </select>
            <select id="soundWave" aria-label="Did you utilize the sound wave baseline?">
                <option value="">Did you utilize the sound wave baseline?</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
        </div>

        <h1>Describe your dream here:</h1>
        <div id="warningBox">You did not use the baseline</div>
        <textarea id="question" placeholder="Type your dream description here..." rows="5" aria-label="Dream Description"></textarea>
        <button id="analyzeButton" onclick="askChatGPT()" aria-label="Analyze Dream">Click here for dream analysis</button>

        <div id="response" aria-live="polite"></div>
    </div>

    <script>
        const analyzeButton = document.getElementById('analyzeButton');
        const countryDropdown = document.getElementById('country');
        const ageDropdown = document.getElementById('age');
        const soundWaveDropdown = document.getElementById('soundWave');
        const warningBox = document.getElementById('warningBox');

        const countries = [
            /* Country list omitted for brevity */
        ];

        // Populate the country dropdown
        countries.forEach(country => {
            const option = document.createElement("option");
            option.value = country;
            option.textContent = country;
            countryDropdown.appendChild(option);
        });

        function validateSelections() {
            let isValid = true;

            [countryDropdown, ageDropdown, soundWaveDropdown].forEach(select => {
                if (!select.value) {
                    select.classList.add('error');
                    isValid = false;
                } else {
                    select.classList.remove('error');
                }
            });

            if (isValid) {
                analyzeButton.classList.add('active');
            } else {
                analyzeButton.classList.remove('active');
            }
        }

        soundWaveDropdown.addEventListener('change', () => {
            if (soundWaveDropdown.value === 'no') {
                warningBox.style.display = 'block'; // Show warning box
            } else {
                warningBox.style.display = 'none'; // Hide warning box
            }
        });

        countryDropdown.addEventListener('change', validateSelections);
        ageDropdown.addEventListener('change', validateSelections);
        soundWaveDropdown.addEventListener('change', validateSelections);

        async function askChatGPT() {
            const question = document.getElementById('question').value;
            const responseDiv = document.getElementById('response');

            if (!question.trim()) {
                responseDiv.textContent = 'Please enter a dream description.';
                return;
            }

            if (!analyzeButton.classList.contains('active')) {
                responseDiv.textContent = 'Please complete all selections before analyzing.';
                return;
            }

            responseDiv.textContent = 'Loading...';

            try {
                const response = await fetch('https://dreamspace-ivna.onrender.com/ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question,
                        country: countryDropdown.value,
                        age: ageDropdown.value,
                        soundWave: soundWaveDropdown.value,
                    }),
                });

                const data = await response.json();
                responseDiv.textContent = data.answer || `Error: ${data.error}`;
            } catch (error) {
                responseDiv.textContent = 'Failed to connect to the server. Please try again later.';
            }
        }
    </script>
</body>
</html>
