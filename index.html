<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Soundwave Dream Analysis</title>
    <meta name="description" content="Sublime dream analysis and dream interpretation." />
    <meta name="keywords" content="dream analysis, dream interpretation, soundwave, sleep, dream insights" />
    <meta name="robots" content="index, follow" />
    <style>
        /* Styling remains unchanged for brevity */
        body {
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            padding: 5% 10%;
            min-height: 100vh;
            background: linear-gradient(180deg, #070D29, #1E3A8A);
            color: #ffffff;
            font-size: calc(16px + 0.2vw);
            line-height: 1.6;
            box-sizing: border-box;
        }
        /* Other styles are unchanged */
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            Harmonize your dreams with sound waves, receive a sublime interpretation.
        </div>
    </div>
    <div class="container">
        <div class="instructions">
            <h1>Soundwave Dream Analysis</h1>
            <p>For optimal results:</p>
            <ol>
                <li>Be sure to play the sound wave track while you sleep. <a href="https://www.youtube.com/watch?v=x4fV17_mIZU" target="_blank" rel="noopener noreferrer">You can find the track by clicking here</a>. Be sure to use your phoneâ€™s second-lowest volume setting, the sound need not be audible while awake.</li>
                <li>Once you have slept, describe your dream below in as much detail as possible.</li>
            </ol>
        </div>
        <div class="dropdown-container">
            <select id="country" aria-label="Select Country">
                <option value="">Select Country</option>
                <!-- All countries will be loaded dynamically -->
            </select>
            <select id="age" aria-label="Select Age">
                <option value="">Select Age</option>
                <option value="Under 18">Under 18</option>
                <option value="18-25">18-25</option>
                <option value="26-35">26-35</option>
                <option value="36-50">36-50</option>
                <option value="51+">51+</option>
            </select>
            <select id="soundWave" aria-label="Did you utilize the sound wave baseline?">
                <option value="">Did you utilize the sound wave baseline?</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
        </div>
        <h1>Describe your dream here:</h1>
        <textarea id="question" placeholder="Type your dream description here..." rows="5" aria-label="Dream Description"></textarea>
        <button id="analyzeButton" onclick="askChatGPT()" aria-label="Analyze Dream">Click here for dream analysis</button>
        <div id="response" aria-live="polite"></div>
    </div>
    <script>
        const analyzeButton = document.getElementById('analyzeButton');
        const countryDropdown = document.getElementById('country');
        const ageDropdown = document.getElementById('age');
        const soundWaveDropdown = document.getElementById('soundWave');
        const questionTextArea = document.getElementById('question');
        const responseDiv = document.getElementById('response');

        const countries = [
            "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", /* More countries */ "Zimbabwe"
        ];

        countries.forEach(country => {
            const option = document.createElement("option");
            option.value = country;
            option.textContent = country;
            countryDropdown.appendChild(option);
        });

        function validateSelections() {
            let isValid = true;

            [countryDropdown, ageDropdown, soundWaveDropdown].forEach(select => {
                if (!select.value) {
                    select.classList.add('error');
                    isValid = false;
                } else {
                    select.classList.remove('error');
                }
            });

            if (isValid && questionTextArea.value.trim()) {
                analyzeButton.classList.add('active');
            } else {
                analyzeButton.classList.remove('active');
            }
        }

        countryDropdown.addEventListener('change', validateSelections);
        ageDropdown.addEventListener('change', validateSelections);
        soundWaveDropdown.addEventListener('change', validateSelections);
        questionTextArea.addEventListener('input', validateSelections);

        async function askChatGPT() {
            const question = questionTextArea.value;

            if (!question.trim()) {
                responseDiv.textContent = 'Please enter a dream description.';
                return;
            }

            if (!analyzeButton.classList.contains('active')) {
                responseDiv.textContent = 'Please complete all selections before analyzing.';
                return;
            }

            responseDiv.textContent = 'Loading...';

            try {
                const response = await fetch('https://dreamspace-ivna.onrender.com/ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question,
                        country: countryDropdown.value,
                        age: ageDropdown.value,
                        soundWave: soundWaveDropdown.value,
                    }),
                });

                const data = await response.json();

                let interpretation = data.answer || `Error: ${data.error}`;

                if (soundWaveDropdown.value === 'no') {
                    interpretation = "You did not play the soundwave baseline while you were asleep, so this interpretation will not be as insightful as a synchronised dream. Next time, sleep with the baseline playing - remember, the volume can be set low. It does not need to be audible while awake. Here is your unsynchronised interpretation:\n\n" + interpretation;
                }

                responseDiv.textContent = interpretation;

                // Smooth scroll to the response section (response box)
                setTimeout(() => {
                    responseDiv.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 0); // Ensures smooth scrolling works with content changes

            } catch (error) {
                responseDiv.textContent = `An error occurred: ${error.message}`;
            }
        }
    </script>
</body>
</html>
