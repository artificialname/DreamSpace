<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Analysis</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f7f9fc;
        }
        .container {
            display: flex;
            flex-direction: column;
            width: 80%;
            max-width: 1200px;
            gap: 20px;
        }
        .dropdown-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        .dropdown-container select {
            padding: 10px;
            font-size: 16px;
            width: 30%;
        }
        .left-column {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            width: 100%;
        }
        h1 {
            color: #333;
            text-align: center;
            width: 100%;
        }
        textarea, button {
            margin-top: 10px;
            padding: 10px;
            font-size: 16px;
            width: 100%;
        }
        button {
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
            opacity: 0.6;
            pointer-events: none;
        }
        button.active {
            opacity: 1;
            pointer-events: auto;
        }
        button:hover {
            background-color: #0056b3;
        }
        #response {
            margin-top: 20px;
            padding: 10px;
            background-color: #e8f0fe;
            border: 1px solid #b6d7ff;
            width: 100%;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Dropdown Section -->
        <div class="dropdown-container">
            <select id="country">
                <option value="">Select Country</option>
            </select>
            <select id="age">
                <option value="">Select Age</option>
            </select>
            <select id="soundWave">
                <option value="">Did you utilize the sound wave baseline?</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
        </div>
        
        <!-- Dream Description Section -->
        <div class="left-column">
            <h1>Describe your dream here. Add as many details as possible.</h1>
            <textarea id="question" placeholder="Type your dream description here..." rows="5"></textarea>
            <button id="analyzeButton" onclick="askChatGPT()">Click here for dream analysis</button>
        </div>

        <div id="response"></div>
    </div>

    <script>
        const countryDropdown = document.getElementById('country');
        const ageDropdown = document.getElementById('age');
        const soundWaveDropdown = document.getElementById('soundWave');
        const analyzeButton = document.getElementById('analyzeButton');

        // Full list of countries
        const countries = [
            "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", 
            "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium",
            "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", 
            "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", 
            "Chile", "China", "Colombia", "Comoros", "Congo (Congo-Brazzaville)", "Costa Rica", "Croatia", "Cuba", "Cyprus", 
            "Czechia (Czech Republic)", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuador", "Egypt", 
            "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini (fmr. Swaziland)", "Ethiopia", "Fiji", 
            "Finland", "France", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", 
            "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Holy See", "Honduras", "Hungary", "Iceland", "India", "Indonesia", 
            "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", 
            "Korea (North)", "Korea (South)", "Kosovo", "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", 
            "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", 
            "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", 
            "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar (Burma)", "Namibia", "Nauru", "Nepal", "Netherlands", 
            "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Macedonia", "Norway", "Oman", "Pakistan", "Palau", 
            "Palestine State", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", 
            "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", 
            "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", 
            "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", "South Africa", "South Sudan", "Spain", 
            "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", "Tajikistan", "Tanzania", "Thailand", 
            "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu", "Uganda", 
            "Ukraine", "United Arab Emirates", "United Kingdom", "United States of America", "Uruguay", "Uzbekistan", 
            "Vanuatu", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
        ];

        countries.forEach(country => {
            const option = document.createElement('option');
            option.value = country;
            option.textContent = country;
            countryDropdown.appendChild(option);
        });

        // Populate the age dropdown
        for (let i = 1; i <= 100; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            ageDropdown.appendChild(option);
        }

        // Enable button only if all dropdowns have valid selections
        function validateSelections() {
            if (
                countryDropdown.value &&
                ageDropdown.value &&
                soundWaveDropdown.value
            ) {
                analyzeButton.classList.add('active');
            } else {
                analyzeButton.classList.remove('active');
            }
        }

        // Add event listeners to validate selections
        countryDropdown.addEventListener('change', validateSelections);
        ageDropdown.addEventListener('change', validateSelections);
        soundWaveDropdown.addEventListener('change', validateSelections);

        let isRequesting = false;

        async function askChatGPT() {
            const question = document.getElementById('question').value;
            const responseDiv = document.getElementById('response');

            if (!question.trim()) {
                responseDiv.textContent = 'Please enter a dream description.';
                return;
            }

            if (!analyzeButton.classList.contains('active')) {
                responseDiv.textContent = 'Please complete all selections before analyzing.';
                return;
            }

            responseDiv.textContent = 'Loading...';
            isRequesting = true;

            try {
                const response = await fetch('https://dreamspace-ivna.onrender.com/ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        question,
                        country: countryDropdown.value,
                        age: ageDropdown.value,
                        soundWave: soundWaveDropdown.value,
                    }),
                });

                const data = await response.json();
                responseDiv.textContent = data.answer || `Error: ${data.error}`;
            } catch (error) {
                responseDiv.textContent = 'Failed to connect to the server. Please try again later.';
            } finally {
                isRequesting = false;
            }
        }
    </script>
</body>
</html>
